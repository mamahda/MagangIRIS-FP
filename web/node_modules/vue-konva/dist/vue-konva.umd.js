(function(d,i){typeof exports=="object"&&typeof module<"u"?module.exports=i(require("vue"),require("konva")):typeof define=="function"&&define.amd?define(["vue","konva"],i):(d=typeof globalThis<"u"?globalThis:d||self,d["vue-konva"]=i(d.Vue,d.Konva))})(this,function(d,i){"use strict";function h(c){if(!i.autoDrawEnabled){const t=c.getLayer()||c.getStage();t&&t.batchDraw()}}const m={key:!0,style:!0,elm:!0,isRootInsert:!0},N=".vue-konva-event";function w(c,t,o,u){const e=c.__konvaNode,f={};let n=!1;for(let r in o){if(m.hasOwnProperty(r))continue;const a=r.slice(0,2)==="on",p=o[r]!==t[r];if(a&&p){let l=r.slice(2).toLowerCase();l.slice(0,7)==="content"&&(l="content"+l.slice(7,1).toUpperCase()+l.slice(8)),e==null||e.off(l+N,o[r])}!t.hasOwnProperty(r)&&(e==null||e.setAttr(r,void 0))}for(let r in t){if(m.hasOwnProperty(r))continue;let a=r.slice(0,2)==="on";const p=o[r]!==t[r];if(a&&p){let s=r.slice(2).toLowerCase();s.slice(0,7)==="content"&&(s="content"+s.slice(7,1).toUpperCase()+s.slice(8)),t[r]&&(e==null||e.off(s+N),e==null||e.on(s+N,t[r]))}!a&&(t[r]!==o[r]||u&&t[r]!==(e==null?void 0:e.getAttr(r)))&&(n=!0,f[r]=t[r])}n&&e&&(e.setAttrs(f),h(e))}const P="v";function T(c){function t(o){return o!=null&&o.__konvaNode?o:o!=null&&o.parent?t(o.parent):(console.error("vue-konva error: Can not find parent node"),null)}return t(c.parent)}function S(c){return c.component?c.component.__konvaNode||S(c.component.subTree):null}function A(c){const{el:t,component:o}=c,u=S(c);if(t!=null&&t.tagName&&o&&!u){const e=t.tagName.toLowerCase();return console.error(`vue-konva error: You are trying to render "${e}" inside your component tree. Looks like it is not a Konva node. You can render only Konva components inside the Stage.`),null}return u}function E(c){const t=e=>!!(e!=null&&e.hasOwnProperty("component")),o=e=>Array.isArray(e),u=e=>t(e)?[e,...u(e.children)]:o(e)?e.flatMap(u):[];return u(c.children)}function v(c,t){const o=E(c),u=[];o.forEach(f=>{const n=A(f);n&&u.push(n)});let e=!1;u.forEach((f,n)=>{f.getZIndex()!==n&&(f.setZIndex(n),e=!0)}),e&&h(t)}const L=d.defineComponent({name:"Stage",props:{config:{type:Object,default:function(){return{}}},__useStrictMode:{type:Boolean}},inheritAttrs:!1,setup(c,{attrs:t,slots:o,expose:u}){const e=d.getCurrentInstance();if(!e)return;const f=d.reactive({}),n=d.ref(null),r=new i.Stage({width:c.config.width,height:c.config.height,container:document.createElement("div")});e.__konvaNode=r,s();function a(){return e==null?void 0:e.__konvaNode}function p(){return e==null?void 0:e.__konvaNode}function s(){if(!e)return;const l=f||{},_={...t,...c.config};w(e,_,l,c.__useStrictMode),Object.assign(f,_)}return d.onMounted(()=>{n.value&&(n.value.innerHTML="",r.container(n.value)),s()}),d.onUpdated(()=>{s(),v(e.subTree,r)}),d.onBeforeUnmount(()=>{r.destroy()}),d.watch(()=>c.config,s,{deep:!0}),u({getStage:p,getNode:a}),()=>{var l;return d.h("div",{ref:n},(l=o.default)==null?void 0:l.call(o))}}}),b=".vue-konva-event",x={Group:!0,Layer:!0,FastLayer:!0,Label:!0};function O(c,t){return d.defineComponent({name:c,props:{config:{type:Object,default:function(){return{}}},__useStrictMode:{type:Boolean}},setup(o,{attrs:u,slots:e,expose:f}){const n=d.getCurrentInstance();if(!n)return;const r=d.reactive({}),a=new t;n.__konvaNode=a,n.vnode.__konvaNode=a,l();function p(){return n==null?void 0:n.__konvaNode}function s(){return n==null?void 0:n.__konvaNode}function l(){if(!n)return;const g={};for(const k in n==null?void 0:n.vnode.props)k.slice(0,2)==="on"&&(g[k]=n.vnode.props[k]);const y=r||{},C={...u,...o.config,...g};w(n,C,y,o.__useStrictMode),Object.assign(r,C)}d.onMounted(()=>{var y;const g=(y=T(n))==null?void 0:y.__konvaNode;g&&"add"in g&&g.add(a),h(a)}),d.onUnmounted(()=>{h(a),a.destroy(),a.off(b)}),d.onUpdated(()=>{l(),v(n.subTree,a)}),d.watch(()=>o.config,l,{deep:!0}),f({getStage:s,getNode:p});const _=x.hasOwnProperty(c);return()=>{var g;return _?d.h("template",{},(g=e.default)==null?void 0:g.call(e)):null}}})}return typeof window<"u"&&!window.Konva&&require("konva"),{install:(c,t)=>{const o=(t==null?void 0:t.prefix)||P,u={Arc:i.Arc,Arrow:i.Arrow,Circle:i.Circle,Ellipse:i.Ellipse,FastLayer:i.FastLayer,Group:i.Group,Image:i.Image,Label:i.Label,Layer:i.Layer,Line:i.Line,Path:i.Path,Rect:i.Rect,RegularPolygon:i.RegularPolygon,Ring:i.Ring,Shape:i.Shape,Sprite:i.Sprite,Star:i.Star,Tag:i.Tag,Text:i.Text,TextPath:i.TextPath,Transformer:i.Transformer,Wedge:i.Wedge,...t==null?void 0:t.customNodes};[L,...Object.entries(u).map(([f,n])=>O(f,n))].forEach(f=>{c.component(`${o}${f.name}`,f)})}}});
